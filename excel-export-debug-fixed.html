<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug Excel Export Issue - Fixed</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #dc3545;
      }
      .header h1 {
        color: #dc3545;
        margin-bottom: 10px;
      }
      .problem {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      .solution {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      .code {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 15px;
        font-family: "Courier New", monospace;
        font-size: 14px;
        margin: 10px 0;
        overflow-x: auto;
      }
      .step {
        margin: 20px 0;
        padding: 15px;
        border-left: 4px solid #28a745;
        background-color: #f8f9fa;
      }
      .step::before {
        content: "âœ… ";
        font-weight: bold;
        color: #28a745;
        margin-right: 8px;
      }
      .test-section {
        margin: 30px 0;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
      }
      .error-type {
        background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: bold;
        display: inline-block;
        margin: 5px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ”§ Debug: Excel Export Issue - FIXED</h1>
        <p>Giáº£i quyáº¿t váº¥n Ä‘á» load lÃ¢u vÃ  Ä‘á»©ng trang khi xuáº¥t Excel</p>
      </div>

      <div class="problem">
        <h2>âŒ Váº¥n Ä‘á» Ä‘Ã£ phÃ¡t hiá»‡n</h2>
        <div class="error-type">INFINITE RECURSION ERROR</div>
        <p><strong>Triá»‡u chá»©ng:</strong></p>
        <ul>
          <li>Trang load ráº¥t lÃ¢u khi nháº¥n nÃºt xuáº¥t Excel</li>
          <li>Browser bá»‹ Ä‘á»©ng hoáº·c crash</li>
          <li>Toast loading "Äang táº¡o file Excel..." khÃ´ng biáº¿n máº¥t</li>
          <li>File Excel khÃ´ng Ä‘Æ°á»£c táº£i xuá»‘ng</li>
        </ul>
      </div>

      <div class="test-section">
        <h2>ğŸ” NguyÃªn nhÃ¢n gá»‘c rá»…</h2>

        <h3>1. Xung Ä‘á»™t tÃªn hÃ m (Function Name Collision)</h3>
        <div class="code">
          <strong>âŒ Code cÃ³ lá»—i:</strong>
          // Import function tá»« utils import { exportToExcel } from
          "../../utils/excelExport"; // Äá»‹nh nghÄ©a function cÃ¹ng tÃªn trong
          component const exportToExcel = useCallback(async () => { // ... await
          exportToExcel({ // â† ÄÃ¢y lÃ  váº¥n Ä‘á»! // Gá»i chÃ­nh nÃ³ thay vÃ¬ utils
          function }); });
        </div>

        <h3>2. Infinite Recursion (Äá»‡ quy vÃ´ táº­n)</h3>
        <p>
          Khi function <code>exportToExcel</code> trong component gá»i
          <code>await exportToExcel()</code>, nÃ³ Ä‘ang gá»i chÃ­nh nÃ³ thay vÃ¬ gá»i
          function tá»« utils, táº¡o ra vÃ²ng láº·p vÃ´ táº­n:
        </p>

        <div class="code">
          exportToExcel() â†’ calls exportToExcel() â†’ calls exportToExcel() â†’ ...
          â†‘ â†“
          â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†â†
        </div>

        <h3>3. Háº­u quáº£</h3>
        <ul>
          <li>Call stack overflow</li>
          <li>Memory leak</li>
          <li>Browser freezing</li>
          <li>UI khÃ´ng pháº£n há»“i</li>
        </ul>
      </div>

      <div class="solution">
        <h2>âœ… Giáº£i phÃ¡p Ä‘Ã£ Ã¡p dá»¥ng</h2>

        <h3>1. Äá»•i tÃªn import Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t</h3>
        <div class="code">
          <strong>âœ… Code Ä‘Ã£ sá»­a:</strong>
          // Import vá»›i alias Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t tÃªn import { exportToExcel as
          exportExcelUtil } from "../../utils/excelExport"; // Function trong
          component giá»¯ nguyÃªn tÃªn const exportToExcel = useCallback(async () =>
          { // ... await exportExcelUtil({ // â† Gá»i Ä‘Ãºng utils function data:
          exportData, columns: exportColumns, // ... }); });
        </div>

        <h3>2. Workflow má»›i hoáº¡t Ä‘á»™ng Ä‘Ãºng</h3>
        <div class="code">
          User click "Xuáº¥t Excel" â†’ exportToExcel() (component function) â†’
          exportExcelUtil() (utils function) â†’ ExcelJS processing â†’ File
          download â†’ Success toast
        </div>
      </div>

      <div class="test-section">
        <h2>ğŸ§ª Kiá»ƒm tra sau khi sá»­a</h2>

        <div class="step">
          <strong>Test function naming</strong>
          <div class="code">
            âœ… Import: exportToExcel as exportExcelUtil âœ… Local function:
            exportToExcel âœ… Call: await exportExcelUtil(...) âœ… No naming
            conflicts
          </div>
        </div>

        <div class="step">
          <strong>Test Excel export flow</strong>
          <ul>
            <li>Click nÃºt "Xuáº¥t Excel"</li>
            <li>Toast loading hiá»ƒn thá»‹ ngay láº­p tá»©c</li>
            <li>File Excel Ä‘Æ°á»£c táº¡o vÃ  táº£i xuá»‘ng trong vÃ i giÃ¢y</li>
            <li>Toast success hiá»ƒn thá»‹</li>
            <li>KhÃ´ng cÃ³ freeze hay crash</li>
          </ul>
        </div>

        <div class="step">
          <strong>Test keyboard shortcut</strong>
          <ul>
            <li>Nháº¥n Ctrl+E</li>
            <li>Function Ä‘Æ°á»£c gá»i Ä‘Ãºng</li>
            <li>KhÃ´ng cÃ³ infinite loop</li>
          </ul>
        </div>

        <div class="step">
          <strong>Test error handling</strong>
          <ul>
            <li>Try/catch hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng</li>
            <li>Error toast hiá»ƒn thá»‹ khi cÃ³ lá»—i</li>
            <li>Loading toast Ä‘Æ°á»£c dismiss Ä‘Ãºng cÃ¡ch</li>
          </ul>
        </div>
      </div>

      <div class="test-section">
        <h2>ğŸ”§ Technical Details</h2>

        <h3>Files Ä‘Ã£ sá»­a Ä‘á»•i:</h3>
        <div class="code">
          ğŸ“ src/pages/User/TutorRevenueStable.jsx â”œâ”€â”€ âœ… Line 7: Import with
          alias â”‚ import { exportToExcel as exportExcelUtil } from
          "../../utils/excelExport"; â”œâ”€â”€ âœ… Line 153: Keep local function name â”‚
          const exportToExcel = useCallback(async () => { â””â”€â”€ âœ… Line 201: Call
          utils function await exportExcelUtil({
        </div>

        <h3>Function call hierarchy:</h3>
        <div class="code">
          Component Level: â”œâ”€â”€ exportToExcel() â† User interaction â”‚ â”œâ”€â”€ Data
          preparation â”‚ â”œâ”€â”€ Statistics calculation â”‚ â””â”€â”€ await exportExcelUtil()
          â† Utils call â”‚ Utils Level: â””â”€â”€ exportExcelUtil() â† From
          utils/excelExport.js â”œâ”€â”€ ExcelJS workbook creation â”œâ”€â”€ Logo embedding
          â”œâ”€â”€ Data formatting â””â”€â”€ File download
        </div>
      </div>

      <div class="solution">
        <h2>ğŸ‰ Káº¿t quáº£</h2>
        <p><strong>Váº¥n Ä‘á» Ä‘Ã£ Ä‘Æ°á»£c giáº£i quyáº¿t hoÃ n toÃ n!</strong></p>
        <ul>
          <li>âœ… KhÃ´ng cÃ²n infinite recursion</li>
          <li>âœ… Excel export hoáº¡t Ä‘á»™ng mÆ°á»£t mÃ </li>
          <li>âœ… File Excel vá»›i logo Van Lang Ä‘Æ°á»£c táº¡o Ä‘Ãºng</li>
          <li>âœ… UI responsive, khÃ´ng bá»‹ Ä‘á»©ng</li>
          <li>âœ… Toast notifications hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng</li>
          <li>âœ… Keyboard shortcuts (Ctrl+E) hoáº¡t Ä‘á»™ng</li>
        </ul>

        <div class="code">
          <strong>ğŸ§ª Test URL:</strong>
          http://localhost:3000/user/tutor-revenue-stable

          <strong>ğŸ¯ Test steps:</strong>
          1. ÄÄƒng nháº­p vá»›i tÃ i khoáº£n gia sÆ° 2. Click nÃºt "Xuáº¥t Excel" hoáº·c nháº¥n
          Ctrl+E 3. Kiá»ƒm tra file Excel táº£i xuá»‘ng cÃ³ logo Van Lang 4. Verify
          khÃ´ng cÃ³ freeze hay performance issues
        </div>
      </div>

      <div class="test-section">
        <h2>ğŸ“š BÃ i há»c kinh nghiá»‡m</h2>

        <h3>ğŸš¨ Nhá»¯ng lá»—i cáº§n trÃ¡nh:</h3>
        <ul>
          <li>
            <strong>Function name collision:</strong> KhÃ´ng Ä‘áº·t tÃªn function
            trÃ¹ng vá»›i import
          </li>
          <li>
            <strong>Self-calling functions:</strong> LuÃ´n kiá»ƒm tra function Ä‘ang
            gá»i cÃ³ Ä‘Ãºng scope khÃ´ng
          </li>
          <li>
            <strong>Missing debugging:</strong> Sá»­ dá»¥ng console.log Ä‘á»ƒ trace
            function calls
          </li>
          <li>
            <strong>Insufficient testing:</strong> Test tá»«ng function riÃªng biá»‡t
            trÆ°á»›c khi integration
          </li>
        </ul>

        <h3>âœ… Best practices:</h3>
        <ul>
          <li>
            <strong>Clear naming:</strong> Sá»­ dá»¥ng alias cho imports khi cáº§n
            thiáº¿t
          </li>
          <li>
            <strong>Function scoping:</strong> Hiá»ƒu rÃµ scope cá»§a tá»«ng function
          </li>
          <li>
            <strong>Error handling:</strong> Wrap async functions trong
            try/catch
          </li>
          <li>
            <strong>User feedback:</strong> LuÃ´n cÃ³ loading states vÃ 
            notifications
          </li>
        </ul>
      </div>
    </div>

    <script>
      console.log("ğŸ”§ Excel Export Debug Report");
      console.log("âœ… Issue: Infinite recursion in exportToExcel function");
      console.log("âœ… Root cause: Function name collision");
      console.log(
        "âœ… Solution: Import aliasing (exportToExcel as exportExcelUtil)"
      );
      console.log("âœ… Status: FIXED");

      // Test if we're running on the actual page
      if (window.location.href.includes("tutor-revenue-stable")) {
        console.log("ğŸ¯ Running on actual TutorRevenueStable page");
        console.log("ğŸ“Š Ready to test Excel export functionality");
      } else {
        console.log("ğŸ“‹ Debug report page loaded");
        setTimeout(() => {
          if (
            confirm(
              "Báº¡n cÃ³ muá»‘n má»Ÿ trang TutorRevenueStable Ä‘á»ƒ test Excel export Ä‘Ã£ sá»­a khÃ´ng?"
            )
          ) {
            window.open(
              "http://localhost:3000/user/tutor-revenue-stable",
              "_blank"
            );
          }
        }, 2000);
      }
    </script>
  </body>
</html>
