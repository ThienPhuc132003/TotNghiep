<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üîß Zoom OAuth Return to Room Management Fix</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .content {
        padding: 30px;
      }

      .status-box {
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        border-left: 5px solid;
      }

      .status-box.error {
        background: #ffebee;
        border-color: #f44336;
        color: #c62828;
      }

      .status-box.success {
        background: #e8f5e8;
        border-color: #4caf50;
        color: #2e7d32;
      }

      .status-box.info {
        background: #e3f2fd;
        border-color: #2196f3;
        color: #1565c0;
      }

      .status-box.warning {
        background: #fff3e0;
        border-color: #ff9800;
        color: #ef6c00;
      }

      .section {
        margin: 30px 0;
        padding: 25px;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        background: #fafafa;
      }

      .section h3 {
        color: #333;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #eee;
      }

      .code-block {
        background: #2d3748;
        color: #f7fafc;
        padding: 20px;
        border-radius: 8px;
        font-family: "JetBrains Mono", "Fira Code", "Courier New", monospace;
        font-size: 14px;
        overflow-x: auto;
        margin: 15px 0;
        line-height: 1.5;
        white-space: pre-wrap;
      }

      .before-after {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
      }

      .before,
      .after {
        padding: 15px;
        border-radius: 8px;
      }

      .before {
        background: #ffebee;
        border: 1px solid #f44336;
      }

      .after {
        background: #e8f5e8;
        border: 1px solid #4caf50;
      }

      .btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s ease;
        margin: 10px 5px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .btn-danger {
        background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      }

      .test-steps {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
      }

      .test-steps ol {
        padding-left: 20px;
      }

      .test-steps li {
        margin: 10px 0;
        line-height: 1.6;
      }

      .highlight {
        background: #fff3cd;
        padding: 2px 5px;
        border-radius: 3px;
        font-weight: bold;
      }

      .flow-diagram {
        border: 2px solid #007bff;
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        background: #f8f9ff;
      }

      .flow-step {
        background: #ffffff;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px;
        margin: 10px 0;
        display: flex;
        align-items: center;
      }

      .flow-step .step-number {
        background: #007bff;
        color: white;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-weight: bold;
      }

      .flow-step .step-content {
        flex: 1;
      }

      .arrow {
        text-align: center;
        font-size: 24px;
        color: #007bff;
        margin: 10px 0;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="header">
        <h1>üîß Zoom OAuth Return to Room Management</h1>
        <p>Fix ƒë·ªÉ redirect v·ªÅ trang qu·∫£n l√Ω ph√≤ng h·ªçc sau OAuth</p>
      </div>

      <div class="content">
        <div class="status-box warning">
          <strong>üéØ USER REQUEST:</strong> Sau khi ƒëƒÉng nh·∫≠p Zoom OAuth, user
          mu·ªën ƒë∆∞·ª£c redirect v·ªÅ trang <strong>qu·∫£n l√Ω ph√≤ng h·ªçc</strong> (danh
          s√°ch c√°c ph√≤ng h·ªçc) thay v√¨ trang meetings c·ªßa classroom c·ª• th·ªÉ.
        </div>

        <div class="status-box success">
          <strong>‚úÖ SOLUTION APPLIED:</strong> ƒê√£ c·∫≠p nh·∫≠t returnPath v√† logic
          ZoomCallback ƒë·ªÉ redirect v·ªÅ trang qu·∫£n l√Ω ph√≤ng h·ªçc.
        </div>

        <div class="section">
          <h3>üîß Code Changes Applied</h3>

          <div class="before-after">
            <div class="before">
              <h4>‚ùå Before (Specific Classroom)</h4>
              <div class="code-block">
                // TutorClassroomMeetingsPage.jsx const returnPath =
                `/tai-khoan/ho-so/quan-ly-lop-hoc/${classroomId}/meetings`; //
                ZoomCallback.jsx if (returnPath.includes("quan-ly-lop-hoc") ||
                returnPath.includes("quan-ly-phong-hoc")) { // Add
                classroom-specific params const params = new URLSearchParams({
                fromZoomConnection: "true", classroomId:
                encodeURIComponent(returnStateData.classroomId), classroomName:
                encodeURIComponent(returnStateData.classroomName) });
                navigate(`${returnPath}?${params.toString()}`); }
              </div>
            </div>

            <div class="after">
              <h4>‚úÖ After (Room Management)</h4>
              <div class="code-block">
                // TutorClassroomMeetingsPage.jsx const returnPath =
                `/tai-khoan/ho-so/quan-ly-phong-hoc`; // ZoomCallback.jsx if
                (returnPath.includes("quan-ly-lop-hoc") &&
                returnPath.includes("/meetings")) { // Specific classroom
                meetings page // ... add classroom params } else if
                (returnPath.includes("quan-ly-phong-hoc")) { // General room
                management page const params = new URLSearchParams({
                fromZoomConnection: "true", });
                navigate(`${returnPath}?${params.toString()}`); }
              </div>
            </div>
          </div>
        </div>

        <div class="section">
          <h3>üéØ New Flow Diagram</h3>

          <div class="flow-diagram">
            <h4>üìã Complete User Journey (Updated)</h4>

            <div class="flow-step">
              <div class="step-number">1</div>
              <div class="step-content">
                <strong>User on Classroom Meetings Page</strong><br />
                <code
                  >/tai-khoan/ho-so/quan-ly-lop-hoc/{classroomId}/meetings</code
                >
              </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <div class="flow-step">
              <div class="step-number">2</div>
              <div class="step-content">
                <strong>Click "T·∫°o ph√≤ng h·ªçc"</strong><br />
                No Zoom token found ‚Üí Need OAuth
              </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <div class="flow-step">
              <div class="step-number">3</div>
              <div class="step-content">
                <strong>Store Return State</strong><br />
                <code>returnPath: "/tai-khoan/ho-so/quan-ly-phong-hoc"</code
                ><br />
                <code>returnState: {classroomId, classroomName}</code>
              </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <div class="flow-step">
              <div class="step-number">4</div>
              <div class="step-content">
                <strong>Redirect to Zoom OAuth</strong><br />
                Call <code>meeting/auth</code> API ‚Üí Get dynamic OAuth URL
              </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <div class="flow-step">
              <div class="step-number">5</div>
              <div class="step-content">
                <strong>User Completes OAuth</strong><br />
                Zoom redirects back to ZoomCallback with auth code
              </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <div class="flow-step">
              <div class="step-number">6</div>
              <div class="step-content">
                <strong>ZoomCallback Processing</strong><br />
                Exchange code for tokens ‚Üí Store in localStorage
              </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <div class="flow-step">
              <div class="step-number">7</div>
              <div class="step-content">
                <strong>Redirect to Room Management</strong><br />
                <code
                  >/tai-khoan/ho-so/quan-ly-phong-hoc?fromZoomConnection=true</code
                >
              </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <div class="flow-step">
              <div class="step-number">8</div>
              <div class="step-content">
                <strong>Success Toast & Clean URL</strong><br />
                Show "Zoom ƒë√£ k·∫øt n·ªëi th√†nh c√¥ng!" ‚Üí Remove query params
              </div>
            </div>
          </div>
        </div>

        <div class="section">
          <h3>üìã Expected URLs</h3>

          <div class="test-steps">
            <h4>URL Changes Throughout The Flow:</h4>
            <ol>
              <li>
                <strong>Starting Page:</strong><br />
                <code
                  >https://giasuvlu.click/tai-khoan/ho-so/quan-ly-lop-hoc/{classroomId}/meetings</code
                >
              </li>

              <li>
                <strong>OAuth Redirect:</strong><br />
                <code>https://zoom.us/oauth/authorize?...</code>
              </li>

              <li>
                <strong>Callback Return:</strong><br />
                <code
                  >https://giasuvlu.click/tai-khoan/ho-so/quan-ly-phong-hoc?fromZoomConnection=true</code
                >
              </li>

              <li>
                <strong>Final Clean URL:</strong><br />
                <code
                  >https://giasuvlu.click/tai-khoan/ho-so/quan-ly-phong-hoc</code
                >
              </li>
            </ol>
          </div>
        </div>

        <div class="section">
          <h3>üß™ Testing Instructions</h3>

          <div class="status-box warning">
            <strong>Prerequisites:</strong>
            <ul style="margin-top: 10px; padding-left: 20px">
              <li>Deploy updated code to production</li>
              <li>Clear any existing Zoom tokens</li>
              <li>Have a classroom available for testing</li>
            </ul>
          </div>

          <div class="test-steps">
            <ol>
              <li>
                <strong>Clear Zoom token:</strong><br />
                <code>localStorage.removeItem("zoomAccessToken");</code>
              </li>

              <li>
                <strong>Navigate to classroom meetings page:</strong><br />
                <code
                  >https://giasuvlu.click/tai-khoan/ho-so/quan-ly-lop-hoc/{classroomId}/meetings</code
                >
              </li>

              <li>
                <strong>Click "T·∫°o ph√≤ng h·ªçc"</strong><br />
                ‚Üí Should redirect to Zoom OAuth
              </li>

              <li>
                <strong>Complete Zoom OAuth</strong><br />
                ‚Üí Should return to:
                <span class="highlight"
                  >/tai-khoan/ho-so/quan-ly-phong-hoc</span
                >
              </li>

              <li>
                <strong>Verify success:</strong>
                <ul style="margin-top: 10px; padding-left: 20px">
                  <li>‚úÖ Landed on room management page (list of all rooms)</li>
                  <li>‚úÖ Success toast: "Zoom ƒë√£ k·∫øt n·ªëi th√†nh c√¥ng!"</li>
                  <li>‚úÖ URL is clean (no query params)</li>
                  <li>‚úÖ Can now create meetings in any classroom</li>
                </ul>
              </li>
            </ol>
          </div>
        </div>

        <div class="section">
          <h3>üîç Debug Console Logs</h3>

          <div>Expected console output when testing:</div>
          <div class="code-block">
            // TutorClassroomMeetingsPage.jsx üîó Redirecting to Zoom OAuth... üíæ
            Storing return state: { returnPath:
            "/tai-khoan/ho-so/quan-ly-phong-hoc", returnState: { fromZoomOAuth:
            true, classroomId: "14907ca0-0140-447d-8dac-5d380781646b",
            classroomName: "L·ªõp h·ªçc v·ªõi gia s∆∞ Tr·ªãnh VƒÉn Thi√™n Ph√∫c" } } üì°
            Calling meeting/auth API... // ZoomCallback.jsx ‚úÖ OAuth tokens
            stored successfully üîÑ Redirecting to:
            /tai-khoan/ho-so/quan-ly-phong-hoc?fromZoomConnection=true // Room
            Management Page (if exists) üîç Detected OAuth return:
            fromZoomConnection=true ‚úÖ Zoom connection successful - showing
            toast
          </div>

          <button class="btn" onclick="simulateFlow()">
            üéØ Simulate Complete Flow
          </button>
          <div id="flowOutput" style="display: none"></div>
        </div>

        <div class="section">
          <h3>üé® Benefits of This Approach</h3>

          <div class="status-box info">
            <strong>User Experience Improvements:</strong>
            <ul style="margin-top: 10px; padding-left: 20px">
              <li>
                <strong>Clear Navigation:</strong> User returns to main room
                management page
              </li>
              <li>
                <strong>Flexible Workflow:</strong> Can create meetings for any
                classroom
              </li>
              <li>
                <strong>No Confusion:</strong> Not tied to a specific classroom
                context
              </li>
              <li><strong>Clean URLs:</strong> No leftover query parameters</li>
              <li>
                <strong>Success Feedback:</strong> Clear indication that Zoom is
                now connected
              </li>
            </ul>
          </div>
        </div>

        <div class="status-box success">
          <strong>üéâ EXPECTED OUTCOME:</strong> Sau khi OAuth th√†nh c√¥ng, user
          s·∫Ω ƒë∆∞·ª£c redirect v·ªÅ trang qu·∫£n l√Ω ph√≤ng h·ªçc v·ªõi th√¥ng b√°o th√†nh c√¥ng.
          T·ª´ ƒë√≥ c√≥ th·ªÉ t·∫°o ph√≤ng h·ªçc cho b·∫•t k·ª≥ classroom n√†o m√† kh√¥ng b·ªã r√†ng
          bu·ªôc v·ªõi classroom c·ª• th·ªÉ ban ƒë·∫ßu.
        </div>
      </div>
    </div>

    <script>
      function simulateFlow() {
        const output = document.getElementById("flowOutput");

        const steps = [
          "üé¨ Starting OAuth Flow Simulation...",
          "",
          "üìç Step 1: User on classroom meetings page",
          "URL: /tai-khoan/ho-so/quan-ly-lop-hoc/14907ca0-0140-447d-8dac-5d380781646b/meetings",
          "",
          "üîò Step 2: Click 'T·∫°o ph√≤ng h·ªçc' ‚Üí No Zoom token",
          "üîó Redirecting to Zoom OAuth...",
          "",
          "üíæ Step 3: Storing return state:",
          "returnPath: '/tai-khoan/ho-so/quan-ly-phong-hoc'",
          "returnState: {classroomId: '14907ca0...', classroomName: 'L·ªõp h·ªçc v·ªõi gia s∆∞...'}",
          "",
          "üåê Step 4: Redirect to Zoom OAuth",
          "URL: https://zoom.us/oauth/authorize?...",
          "",
          "‚úÖ Step 5: User completes OAuth",
          "Zoom redirects back with auth code",
          "",
          "‚öôÔ∏è Step 6: ZoomCallback processes",
          "- Exchange code for tokens ‚úÖ",
          "- Store tokens in localStorage ‚úÖ",
          "- Read return state from sessionStorage ‚úÖ",
          "",
          "üéØ Step 7: Smart redirect logic",
          "returnPath contains 'quan-ly-phong-hoc' ‚Üí Room management page",
          "Final URL: /tai-khoan/ho-so/quan-ly-phong-hoc?fromZoomConnection=true",
          "",
          "üéä Step 8: Success state",
          "- Toast: 'Zoom ƒë√£ k·∫øt n·ªëi th√†nh c√¥ng!' ‚úÖ",
          "- Clean URL (remove query params) ‚úÖ",
          "- Ready to create meetings ‚úÖ",
          "",
          "‚ú® Flow Complete! User is now on room management page with Zoom connected.",
        ];

        output.innerHTML = `<div class="code-block">${steps.join("\n")}</div>`;
        output.style.display = "block";

        console.log("üéØ OAuth Flow Simulation:");
        steps.forEach((step, index) => {
          setTimeout(() => console.log(step), index * 100);
        });
      }
    </script>
  </body>
</html>
