<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quick GET Body Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        margin: 10px 5px;
        font-size: 14px;
      }
      button:hover {
        background: #0056b3;
      }
      .success {
        background: #28a745;
      }
      .success:hover {
        background: #218838;
      }
      .danger {
        background: #dc3545;
      }
      .danger:hover {
        background: #c82333;
      }

      .alert {
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
        background: #d1ecf1;
        border: 1px solid #bee5eb;
        color: #0c5460;
      }
      pre {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        overflow-x: auto;
        border: 1px solid #e9ecef;
        max-height: 400px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîß Quick GET Body Test</h1>
      <p>Test nhanh ƒë·ªÉ xem axios c√≥ g·ª≠i body data cho GET request hay kh√¥ng</p>

      <div class="alert">
        <strong>üìã Test n√†y s·∫Ω:</strong><br />
        1. Test axios.request() v·ªõi GET method v√† body data<br />
        2. Test v·ªõi httpbin.org (echo service)<br />
        3. So s√°nh v·ªõi POST request<br />
        4. Test v·ªõi API th·∫≠t c·ªßa b·∫°n
      </div>

      <h3>üß™ Test 1: Echo Service (httpbin.org)</h3>
      <button onclick="testGetWithBody()" class="success">
        Test GET + Body
      </button>
      <button onclick="testPostWithBody()">Test POST + Body (so s√°nh)</button>
      <pre id="echo-result">Ch∆∞a test...</pre>

      <h3>üß™ Test 2: Real API</h3>
      <button onclick="testRealAPI()" class="danger">
        Test Real meeting/get-meeting
      </button>
      <pre id="real-result">Ch∆∞a test...</pre>

      <h3>üîç Console Debug</h3>
      <p>M·ªü Console (F12) ƒë·ªÉ xem chi ti·∫øt request/response</p>
    </div>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
      async function testGetWithBody() {
        console.log("üß™ Testing GET with body via axios.request()...");

        const testData = { classroomId: "test-123", action: "get-meeting" };

        try {
          console.log("üì§ Sending GET request with body:", testData);

          const response = await axios.request({
            method: "GET",
            url: "https://httpbin.org/anything",
            data: testData,
            headers: {
              "Content-Type": "application/json",
            },
          });

          console.log("‚úÖ GET Response:", response.data);

          const result = `‚úÖ GET with Body Success!
Status: ${response.status}
Method Received: ${response.data.method}
Body Data Received: ${JSON.stringify(response.data.data, null, 2)}
Headers: ${JSON.stringify(response.data.headers, null, 2)}`;

          document.getElementById("echo-result").textContent = result;

          // Check if body data was received
          if (response.data.data && response.data.data.classroomId) {
            console.log("‚úÖ SUCCESS: Body data was sent and received!");
          } else {
            console.log("‚ùå FAILED: Body data was NOT received");
          }
        } catch (error) {
          console.error("‚ùå GET test failed:", error);
          document.getElementById(
            "echo-result"
          ).textContent = `‚ùå Error: ${error.message}`;
        }
      }

      async function testPostWithBody() {
        console.log("üß™ Testing POST with body for comparison...");

        const testData = { classroomId: "test-123", action: "get-meeting" };

        try {
          const response = await axios.post(
            "https://httpbin.org/anything",
            testData,
            {
              headers: { "Content-Type": "application/json" },
            }
          );

          console.log("‚úÖ POST Response:", response.data);

          const result = `‚úÖ POST with Body Success!
Status: ${response.status}
Method Received: ${response.data.method}
Body Data Received: ${JSON.stringify(response.data.json, null, 2)}`;

          document.getElementById("echo-result").textContent += "\n\n" + result;
        } catch (error) {
          console.error("‚ùå POST test failed:", error);
        }
      }

      async function testRealAPI() {
        console.log("üß™ Testing real meeting/get-meeting API...");

        // Check if Api function exists
        if (typeof Api === "undefined") {
          const error = "Api function not found. Please load main app first.";
          console.log("‚ùå", error);
          document.getElementById("real-result").textContent = `‚ùå ${error}`;
          return;
        }

        // Check if enableAPILogging exists and enable it
        if (typeof enableAPILogging === "function") {
          enableAPILogging();
          console.log("üîä API Logging enabled");
        }

        const testData = { classroomId: "test-classroom-id-123" };

        try {
          console.log("üì§ Testing real API with data:", testData);
          console.log("üîç Watch console for API Logger output...");

          const response = await Api({
            endpoint: "meeting/get-meeting",
            method: "GET",
            data: testData,
            requireToken: true,
          });

          console.log("‚úÖ Real API Success:", response);

          document.getElementById(
            "real-result"
          ).textContent = `‚úÖ Real API Success!
Response: ${JSON.stringify(response, null, 2)}`;
        } catch (error) {
          console.error("‚ùå Real API failed:", error);

          const errorMsg = error.response?.data?.message || error.message;
          const errorDetails = error.response?.data || error.message;

          document.getElementById(
            "real-result"
          ).textContent = `‚ùå Real API Failed!
Error: ${errorMsg}
Status: ${error.response?.status || "Unknown"}
Details: ${JSON.stringify(errorDetails, null, 2)}`;

          // Check if it's still "Missing meetingId" error
          if (errorMsg.includes("Missing") || errorMsg.includes("meetingId")) {
            console.log("üö® Still getting Missing meetingId error!");
            console.log(
              "üí° This means backend is not receiving the classroomId from body"
            );
          } else {
            console.log("üéØ Different error, might be progress!");
          }
        }
      }

      // Auto-run basic check on load
      window.addEventListener("load", function () {
        console.log("üöÄ Quick GET Body Test loaded");
        console.log(
          "üìã This will test if axios.request() with GET method sends body data"
        );

        // Check available functions
        const checks = {
          axios: typeof axios !== "undefined",
          Api: typeof Api !== "undefined",
          enableAPILogging: typeof enableAPILogging !== "undefined",
        };

        console.log("üîç Available functions:", checks);

        if (!checks.axios) {
          document.getElementById("echo-result").textContent =
            "‚ùå Axios not loaded";
        }
      });
    </script>
  </body>
</html>
