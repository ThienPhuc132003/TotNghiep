<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TutorClassroomPage White Screen Debug</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }
      .debug-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .status-ok {
        color: #28a745;
      }
      .status-error {
        color: #dc3545;
      }
      .status-warning {
        color: #ffc107;
      }
      .code-block {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        border-left: 4px solid #007bff;
        margin: 10px 0;
      }
      .step {
        margin: 15px 0;
        padding: 15px;
        border: 1px solid #dee2e6;
        border-radius: 4px;
      }
      .step h3 {
        margin-top: 0;
        color: #495057;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      #console-output {
        background: #000;
        color: #0f0;
        padding: 15px;
        border-radius: 4px;
        max-height: 400px;
        overflow-y: auto;
        font-family: "Courier New", monospace;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="debug-container">
      <h1>üîç TutorClassroomPage White Screen Debug Guide</h1>
      <p>
        This tool will help you debug the white screen issue on the
        TutorClassroomPage.
      </p>
    </div>

    <div class="debug-container">
      <h2>üìã Quick Diagnostic Steps</h2>

      <div class="step">
        <h3>Step 1: Check Browser Console</h3>
        <p>
          Open your browser's Developer Tools (F12) and check the Console tab
          for any red error messages.
        </p>
        <div class="code-block">
          <strong>Common errors to look for:</strong><br />
          ‚Ä¢ Uncaught SyntaxError<br />
          ‚Ä¢ Cannot read properties of undefined<br />
          ‚Ä¢ Module not found<br />
          ‚Ä¢ 404 errors for CSS/JS files
        </div>
      </div>

      <div class="step">
        <h3>Step 2: Check Network Tab</h3>
        <p>
          In Developer Tools, go to Network tab and refresh the page. Look for
          failed requests (red status codes).
        </p>
        <div class="code-block">
          <strong>Check for:</strong><br />
          ‚Ä¢ Failed CSS file loads<br />
          ‚Ä¢ Failed API calls<br />
          ‚Ä¢ 404 or 500 errors
        </div>
      </div>

      <div class="step">
        <h3>Step 3: Verify User Authentication</h3>
        <p>Check if you're logged in and have the correct role.</p>
        <button onclick="checkAuth()">Check Authentication</button>
        <div id="auth-result"></div>
      </div>

      <div class="step">
        <h3>Step 4: Test API Connectivity</h3>
        <p>Test if the classroom API is accessible.</p>
        <button onclick="testAPI()">Test API</button>
        <div id="api-result"></div>
      </div>

      <div class="step">
        <h3>Step 5: Clear Cache & Storage</h3>
        <p>Sometimes cached data can cause issues.</p>
        <button onclick="clearStorage()">Clear Storage</button>
        <div id="storage-result"></div>
      </div>
    </div>

    <div class="debug-container">
      <h2>üõ†Ô∏è Manual Fix Steps</h2>

      <div class="step">
        <h3>Fix 1: Hard Refresh</h3>
        <p>Try a hard refresh to clear cached resources:</p>
        <div class="code-block">
          <strong>Windows:</strong> Ctrl + F5<br />
          <strong>Mac:</strong> Cmd + Shift + R
        </div>
      </div>

      <div class="step">
        <h3>Fix 2: Check Route Protection</h3>
        <p>Make sure you're accessing the page with the correct role:</p>
        <div class="code-block">
          1. Log out completely<br />
          2. Log back in as a TUTOR<br />
          3. Navigate to /tai-khoan/ho-so/quan-ly-lop-hoc
        </div>
      </div>

      <div class="step">
        <h3>Fix 3: Restart Development Server</h3>
        <p>If running in development mode:</p>
        <div class="code-block">
          1. Stop the server (Ctrl+C)<br />
          2. Clear node_modules cache: npm ci<br />
          3. Restart: npm start
        </div>
      </div>
    </div>

    <div class="debug-container">
      <h2>üíª Console Output</h2>
      <div id="console-output">Ready to run diagnostics...\n</div>
      <button onclick="runFullDiagnostic()">Run Full Diagnostic</button>
      <button onclick="clearConsole()">Clear Console</button>
    </div>

    <script>
      function log(message, type = "info") {
        const output = document.getElementById("console-output");
        const timestamp = new Date().toLocaleTimeString();
        const colors = {
          info: "#0f0",
          error: "#f00",
          warning: "#ff0",
          success: "#0f0",
        };
        output.innerHTML += `<span style="color: ${colors[type]}">[${timestamp}] ${message}</span>\n`;
        output.scrollTop = output.scrollHeight;
      }

      function clearConsole() {
        document.getElementById("console-output").innerHTML =
          "Console cleared...\n";
      }

      async function checkAuth() {
        log("üîç Checking authentication...", "info");
        const resultDiv = document.getElementById("auth-result");

        try {
          // Check localStorage for tokens
          const accessToken = localStorage.getItem("accessToken");
          const userProfile = localStorage.getItem("persist:root");

          if (!accessToken) {
            log("‚ùå No access token found", "error");
            resultDiv.innerHTML =
              '<span class="status-error">‚ùå Not logged in - No access token</span>';
            return false;
          }

          if (!userProfile) {
            log("‚ùå No user profile found", "error");
            resultDiv.innerHTML =
              '<span class="status-error">‚ùå No user profile found</span>';
            return false;
          }

          try {
            const parsed = JSON.parse(userProfile);
            const user = JSON.parse(parsed.user || "{}");
            const userProfileData = user.userProfile;

            if (userProfileData && userProfileData.role === "TUTOR") {
              log("‚úÖ User is authenticated as TUTOR", "success");
              resultDiv.innerHTML =
                '<span class="status-ok">‚úÖ Authenticated as TUTOR</span>';
              return true;
            } else {
              log(
                `‚ùå User role is not TUTOR: ${userProfileData?.role}`,
                "error"
              );
              resultDiv.innerHTML = `<span class="status-error">‚ùå Role: ${
                userProfileData?.role || "UNKNOWN"
              }</span>`;
              return false;
            }
          } catch (parseError) {
            log("‚ùå Error parsing user data: " + parseError.message, "error");
            resultDiv.innerHTML =
              '<span class="status-error">‚ùå Error parsing user data</span>';
            return false;
          }
        } catch (error) {
          log("‚ùå Authentication check failed: " + error.message, "error");
          resultDiv.innerHTML =
            '<span class="status-error">‚ùå Authentication check failed</span>';
          return false;
        }
      }

      async function testAPI() {
        log("üåê Testing API connectivity...", "info");
        const resultDiv = document.getElementById("api-result");

        try {
          const accessToken = localStorage.getItem("accessToken");
          if (!accessToken) {
            log("‚ùå No access token for API test", "error");
            resultDiv.innerHTML =
              '<span class="status-error">‚ùå No access token</span>';
            return false;
          }

          log("üì° Making API request...", "info");
          const response = await fetch(
            "/api/classroom/search-for-tutor?page=1&rpp=2",
            {
              method: "GET",
              headers: {
                Authorization: `Bearer ${accessToken}`,
                "Content-Type": "application/json",
              },
            }
          );

          log(`üìä API Response status: ${response.status}`, "info");

          if (response.ok) {
            const data = await response.json();
            log("‚úÖ API call successful", "success");
            log(
              `üìà Data received: ${JSON.stringify(data).substring(0, 100)}...`,
              "info"
            );
            resultDiv.innerHTML =
              '<span class="status-ok">‚úÖ API Working</span>';
            return true;
          } else {
            log(
              `‚ùå API error: ${response.status} ${response.statusText}`,
              "error"
            );
            resultDiv.innerHTML = `<span class="status-error">‚ùå API Error: ${response.status}</span>`;
            return false;
          }
        } catch (error) {
          log("‚ùå API test failed: " + error.message, "error");
          resultDiv.innerHTML =
            '<span class="status-error">‚ùå API Connection Failed</span>';
          return false;
        }
      }

      function clearStorage() {
        log("üßπ Clearing browser storage...", "info");
        const resultDiv = document.getElementById("storage-result");

        try {
          // Clear specific items that might cause issues
          const itemsToKeep = ["accessToken", "persist:root"]; // Keep auth data
          const itemsToRemove = [];

          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (!itemsToKeep.includes(key)) {
              itemsToRemove.push(key);
            }
          }

          itemsToRemove.forEach((key) => {
            localStorage.removeItem(key);
            log(`üóëÔ∏è Removed: ${key}`, "info");
          });

          // Clear session storage
          sessionStorage.clear();
          log("üóëÔ∏è Session storage cleared", "info");

          log("‚úÖ Storage cleared (keeping auth data)", "success");
          resultDiv.innerHTML =
            '<span class="status-ok">‚úÖ Storage Cleared</span>';

          // Suggest page refresh
          setTimeout(() => {
            if (confirm("Storage cleared! Refresh the page now?")) {
              window.location.reload();
            }
          }, 1000);
        } catch (error) {
          log("‚ùå Error clearing storage: " + error.message, "error");
          resultDiv.innerHTML =
            '<span class="status-error">‚ùå Clear Failed</span>';
        }
      }

      async function runFullDiagnostic() {
        log("üöÄ Starting full diagnostic...", "info");
        log("=" * 50, "info");

        const results = {
          auth: await checkAuth(),
          api: await testAPI(),
        };

        log("=" * 50, "info");
        log("üìä Diagnostic Summary:", "info");
        log(
          `Authentication: ${results.auth ? "‚úÖ PASS" : "‚ùå FAIL"}`,
          results.auth ? "success" : "error"
        );
        log(
          `API Connectivity: ${results.api ? "‚úÖ PASS" : "‚ùå FAIL"}`,
          results.api ? "success" : "error"
        );

        if (results.auth && results.api) {
          log(
            "üéâ All checks passed! If white screen persists, check console for React errors.",
            "success"
          );
        } else {
          log("üîß Fix the failed checks above and try again.", "warning");
        }

        log("üí° Next steps:", "info");
        log("1. Open /tai-khoan/ho-so/quan-ly-lop-hoc in a new tab", "info");
        log("2. Check browser console (F12) for errors", "info");
        log("3. Check Network tab for failed requests", "info");
      }

      // Auto-run basic checks on page load
      window.addEventListener("load", () => {
        log("üîß Debug tool loaded. Ready to help!", "success");
        log('üí° Click "Run Full Diagnostic" to start checking.', "info");
      });
    </script>
  </body>
</html>
